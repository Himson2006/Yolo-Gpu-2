<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
    /* --- General Setup --- */
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: #f0f2f5; /* A light grey background */
    }

    /* --- Dashboard Title --- */
    .dashboard-header {
        text-align: center;
        padding: 2rem 1rem;
        background-color: #ffffff;
        border-bottom: 1px solid #dee2e6;
    }

    /* --- Main Grid Container --- */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr; /* Default to a single column */
        gap: 2rem; /* Space between charts */
        padding: 2rem;
        max-width: 1600px;
        margin: 0 auto; /* Center the grid */
    }

    /* --- Chart Styling --- */
    .chart-container {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        height: 500px;
    }

    /* --- Responsive Design using a Media Query --- */
    /* When the screen is 1024px wide or more... */
    @media (min-width: 1024px) {
        .dashboard-grid {
            /* Switch to a 2-column grid */
            grid-template-columns: 1fr 1fr;
        }
        /* Make the heatmap span both columns if it's the last chart */
        .chart-container:last-child:nth-child(odd) {
            grid-column: 1 / -1;
        }
    }
</style>
</head>
<body>
    <div class="dashboard-header">
        <h1>Project Dashboard</h1>
    </div>

    <div class="dashboard-grid">
        <div class="chart-container">
            <h2>Class Distribution</h2>
            <div id="classDistributionChart" style="width:100%; height:90%;"></div>
        </div>

        <div class="chart-container">
            <h2>Events Over Time</h2>
            <div id="detectionsOverTimeChart" style="width:100%; height:90%;"></div>
        </div>
        
        <div class="chart-container">
            <h2>Class Co-occurrence</h2>
            <div id="cooccurrenceHeatmap" style="width:100%; height:90%;"></div>
        </div>
    </div>

    <script>
        // --- Pie Chart ---
        async function createClassDistributionChart() {
            const response = await fetch('/api/class_distribution');
            const apiData = await response.json();
            const trace = { labels: apiData.labels, values: apiData.values, type: 'pie' };
            // We removed the title from layout to use the HTML h2 tag
            const layout = { margin: { t: 20, b: 40, l: 40, r: 40 } };
            Plotly.newPlot('classDistributionChart', [trace], layout);
        }

        // --- Line Chart ---
        async function createDetectionsOverTimeChart() {
            const response = await fetch('/api/detections_over_time');
            const apiData = await response.json();
            const trace = { x: apiData.x, y: apiData.y, type: 'scatter', mode: 'lines+markers' };
            const layout = { margin: { t: 20, b: 40, l: 40, r: 40 } };
            Plotly.newPlot('detectionsOverTimeChart', [trace], layout);
        }
        
        // --- Heatmap ---
        async function createCooccurrenceHeatmap() {
            const response = await fetch('/api/class_cooccurrence');
            const apiData = await response.json();
            const trace = { x: apiData.x, y: apiData.y, z: apiData.z, type: 'heatmap', colorscale: 'Viridis' };
            const layout = { margin: { t: 20, b: 40, l: 40, r: 40 } };
            Plotly.newPlot('cooccurrenceHeatmap', [trace], layout);
        }

        // Call all functions
        createClassDistributionChart();
        createDetectionsOverTimeChart();
        createCooccurrenceHeatmap();
    </script>
</body>
</html>