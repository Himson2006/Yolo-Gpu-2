<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Videos</title>
  <style>
    /* simple styling */
    .video-item { margin-bottom: 2rem; }
    .video-player { display: none; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <h1>Search Videos</h1>

  <div class="guide">
  <h3>How to Use the Search</h3>
  <p>
    Enter criteria into one or more fields below and click "Search" to find matching videos. Leave all fields blank to see no results initially.
  </p>
  <ul>
    <li>
      <strong>Available Classes:</strong> The model can identify the following species of interest: 'Deer', 'Rabbit', 'Squirrel', and 'Vulture'.
    </li>
    <li>
      <strong>Class name:</strong> Enter a single class or multiple classes separated by commas (e.g., <em>Deer, Squirrel</em>).
    </li>
    <li>
      <strong>Match Type:</strong> Choose "Match Any (OR)" to find videos with any of the listed species, or "Match All (AND)" to find videos that must contain all listed species.
    </li>
    <li>
      <strong>Min count:</strong> Find videos where a <strong>single species</strong> appears in at least this many frames. This filter only works when one class name is entered.
    </li>
    <li>
      <strong>Date Range:</strong> Find videos recorded on or between the selected start and end dates.
    </li>
    <li>
      <strong>Device ID:</strong> Filter results from a specific camera device ID (e.g., <em>GPU VM</em> ).
    </li>
    <li>
      <strong>Time of Day:</strong> Filter for events that occurred during the day (6am - 6pm) or at night (6pm - 6am).
    </li>
    <li>
      <strong>Min Confidence:</strong> Set a minimum model confidence score from 0.0 to 1.0.
    </li>
    <li>
      <strong>Sort By:</strong> Order the results by date or video duration.
    </li>
  </ul>
</div>

  <form action="{{ url_for('main.search_videos') }}" method="get">
    <label>
      Class name:
      <input type="text" name="class_name" value="{{ class_name or '' }}">
    </label>
     <label>
      <select name="match_type">
        <option value="any" {% if match_type == 'any' %}selected{% endif %}>Match Any (OR)</option>
        <option value="all" {% if match_type == 'all' %}selected{% endif %}>Match All (AND)</option>
      </select>
    </label>
    <br> <label>
      Min count:
      <input type="number" name="min_count" value="{{ min_count or '' }}">
    </label>
    <label>
    Start Date:
      <input type="date" name="start_date" value="{{ start_date or '' }}">
    </label>
    <label>
      End Date:
      <input type="date" name="end_date" value="{{ end_date or '' }}">
    </label>
    <label>
      Device ID:
      <input type="text" name="device_id" value="{{ device_id or '' }}">
    </label>
    <label>
      Time of Day:
      <select name="time_of_day">
        <option value="" {% if not time_of_day %}selected{% endif %}>Any</option>
        <option value="day" {% if time_of_day == 'day' %}selected{% endif %}>Day (6am - 6pm)</option>
        <option value="night" {% if time_of_day == 'night' %}selected{% endif %}>Night (6pm - 6am)</option>
      </select>
    </label>
    <label>
      Min Confidence:
      <input type="number" name="min_confidence" min="0.0" max="1.0" step="0.05" value="{{ min_confidence or '' }}">
    </label>
    <label>
      Sort By:
      <select name="sort_by">
        <option value="recent" {% if sort_by == 'recent' %}selected{% endif %}>Most Recent</option>
        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest</option>
        <option value="longest" {% if sort_by == 'longest' %}selected{% endif %}>Longest Duration</option>
        <option value="shortest" {% if sort_by == 'shortest' %}selected{% endif %}>Shortest Duration</option>
      </select>
    </label>
    <button type="submit">Search</button>
  </form>

  {% if events %}
    <ul>
      {% for event in events %}
        <li class="video-item">
          <strong>{{ event.event_id }}</strong>
          <button type="button"
                  onclick="toggleFrame('{{ event.event_id }}')">
            â–¶ Play
          </button>

          <iframe
+            id="iframe-{{ event.event_id }}"
+            src="{{ url_for('main.player_page', event_id=event.event_id) }}"
+            width="480"
+            height="270"
+            style="display:none; border:0;"
+            allow="autoplay"
+          ></iframe>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>No videos found.</em></p>
  {% endif %}

<script>
  function toggleFrame(id) {
    console.log("toggleFrame called for", id);
    const frame = document.getElementById(`iframe-${id}`);
    if (frame.style.display === 'none' || !frame.style.display) {
      frame.style.display = 'block';
    } else {
      frame.style.display = 'none';
    }
  }
</script>

</body>
</html>